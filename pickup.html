<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pickup Tracker - ReTrack</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f9fafa;
      display: flex; flex-direction: column; align-items: center;
      padding: 40px 20px; color: #1f2937;
    }
    h1 { font-size: 2.2rem; margin-bottom: 10px; }
    input, button {
      padding: 12px; font-size: 1rem; border-radius: 8px; margin: 10px 0; width: 100%;
    }
    button {
      background-color: #3b82f6; color: white; border: none;
      cursor: pointer; transition: background-color 0.3s ease;
    }
    button:hover { background-color: #2563eb; }
    .output p { font-size: 1.1rem; margin: 6px 0; text-align: center; }
  </style>
</head>
<body>
  <h1>Pickup Dashboard</h1>
  <input type="text" id="rfidInput" placeholder="Enter RFID Code">
  <button onclick="startPickup()">Start Pickup</button>
  <button onclick="dropPickup()">Drop Pickup</button>
  <div class="output">
    <p id="classification"></p>
    <p id="sensors"></p>
    <p id="finalDecision"></p>
  </div>

  <script>
    const channelId = '2994468';
    const readKey = 'ORZJ88EUT7HLBIQC';

    function startPickup() {
      const rfid = document.getElementById('rfidInput').value;
      if (!rfid) return alert("Please enter RFID");
      alert(`Pickup started for: ${rfid}`);
    }

    async function dropPickup() {
      const response = await fetch(`https://api.thingspeak.com/channels/${channelId}/feeds.json?api_key=${readKey}&results=1`);
      const data = await response.json();
      const feed = data.feeds[0];

      const classification = feed.field5;
      const confidence = feed.field6;
      const temp = parseFloat(feed.field1);
      const shock = parseFloat(feed.field3);
      const light = parseFloat(feed.field4);

      let decision = "Exchange";
      if (classification === "Return" && shock < 300 && light < 300) {
        decision = "Refundable";
      }

      document.getElementById('classification').innerText = `ðŸ“¦ Classification: ${classification}`;
      document.getElementById('sensors').innerText = `Sensors â†’ Shock: ${shock}, Light: ${light}`;
      document.getElementById('finalDecision').innerText = `âœ… Final Decision: ${decision}`;
    }
  </script>
</body>
</html>
